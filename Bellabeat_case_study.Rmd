---
title: "Bellabeat Case Study"
author: "caitlin"
date: "2022-10-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction and background of this analysis

As a high-tech manufacturer of health-focused products for women, we are successful small company, but we do have the potential to become a larger player in the global smart device market. Based on our current first-hand user data, we conducted in-depth research on user behaviors and needs, to provide basis for our marketing strategies.

## Business questions

1.  What are some trends in smart device usage?
2.  How could these trends apply to Bellabeat customers?
3.  How could these trends help influence Bellabeat marketing strategy?

## Prepare for analysis

Know about dataset The dataset used was generated by respondents to a distributed survey via Bellabeat app between 03.12.2016-05.12.2016. Thirty eligible users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring.

## Processing data

```{r}
library(ggplot2)
library(dplyr)
library(ggpubr)
library(tidyverse)
library(here)
library(skimr)
library(janitor)
library(lubridate)
library(ggrepel)

##importing data
activity <- read.csv("dailyActivity_merged.csv")
head(activity)

sleep <- read.csv("sleepDay_merged.csv")
head(sleep)

weight <- read.csv("weightLogInfo_merged.csv")
head(weight)

intensities <- read.csv("dailyIntensities_merged.csv")
head(intensities)

heartrate <- read.csv("heartrate_seconds_merged.csv")
head(heartrate)

## cleaning and formating
n_distinct(activity$Id)
n_distinct(sleep$Id)
n_distinct(weight$Id)
n_distinct(intensities$Id)
n_distinct(heartrate$Id)

## deleting duplicates
sum(duplicated(activity))
sum(duplicated(sleep))
sum(duplicated(weight))
sum(duplicated(intensities))
sum(duplicated(heartrate))

sleep <- sleep %>%
  distinct() %>%
  drop_na()

sum(duplicated(sleep))

## cleaning names
clean_names(activity)
activity <- rename_with(activity, tolower)

clean_names(sleep)
sleep <- rename_with(sleep, tolower)

clean_names(weight)
weight <- rename_with(weight, tolower)

clean_names(intensities)
intensities <- rename_with(intensities, tolower)

clean_names(heartrate)
heartrate <- rename_with(heartrate, tolower)

str(heartrate)

## formating date
activity <- activity %>%
  rename(date=activitydate) %>%
  mutate(date=as_date(date, format = "%m/%d/%Y"))

sleep <- sleep %>%
  rename(date=sleepday) %>%
  mutate(date=as_date(date,format = "%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone()))

head(activity)
head(sleep)

```

## merging data

```{r}
activity_sleep <- merge(activity, sleep, by=c ("id","date"))
glimpse(activity_sleep)

```

## User analysis

As we categorize users by number of daily steps as below: sedentary : less than 5000 steps lightly active : between 5000 and 7500 steps fairly active: between 7500 and 10000 steps very active: more than 10000

we find that the most users are fairly active with 38%, and the rest 3 classes are equal to each other with 21%. Take a further look into how different types of users spend time each day. Surprisingly, all types of users spend most of their times in sedentary activities including very active users, all with over 10h sedentary time respectively.

As for active activities, users spend much more time on light active activities than fairly active and very active ones.

There is no evidence that sleep time corelates to daily steps, but sleep time is negatively relevant to sedentary time. The longer sedentary time is, the less sleep time is.

```{r}

avg_daily <- activity_sleep %>%
  group_by(id) %>%
  summarise(avg_daily_steps = mean(totalsteps), avg_distance= mean(totaldistance ),avg_calories = mean(calories), avg_sleep_minutes = mean(totalminutesasleep))

head(avg_daily)

user_type <- avg_daily %>%
  mutate(user_type = case_when(
    avg_daily_steps < 5000 ~ "sedentary",
    avg_daily_steps >= 5000 & avg_daily_steps< 7499 ~ "lightly active",
    avg_daily_steps >= 7500 & avg_daily_steps< 10000 ~ "fairly active",
    avg_daily_steps > 10000 ~ "very active"
  ))

user_type_percent <- user_type %>%
  group_by(user_type) %>%
  summarise(total = n()) %>%
  mutate(totals=sum(total))%>%
  group_by(user_type) %>%
  summarise(total_percent = total/totals) %>%
  mutate(labels = scales::percent(total_percent))

user_type_percent$user_type <- factor(user_type_percent$user_type, levels=c("sedentary","lightly active","fairly active","very active"))
head(user_type_percent)

  
user_type_percent %>%
  ggplot(aes(x="", y= total_percent, fill= user_type))+
  geom_bar(stat = "identity", width=1)+
  coord_polar("y", start=0)+
  theme_minimal()+
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        panel.border = element_blank(),
        panel.grid = element_blank(),
        axis.text.x= element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 12, face ="bold"))+
  scale_fill_manual(values = c("#85e085","#e6e600", "#ffd480", "#ff8080"))+
  geom_text(aes(label=labels),
            position = position_stack(vjust = 0.5))+
  labs(title="User type distribution")

head(user_type)

head(activity_sleep)
 
user_type_activity_time <- merge(user_type, activity_sleep, by="id")  %>%
  group_by(user_type) %>%
  summarise(active_time = mean(veryactiveminutes),fairly_time= mean(fairlyactiveminutes), light_time=mean(lightlyactiveminutes),sedentary_time=mean(sedentaryminutes)) %>%
  group_by(user_type) 


View(user_type_activity_time)
head(user_type_activity_time)


ggarrange(
  ggplot(user_type_activity_time) +
    geom_col(aes(user_type, active_time), fill = "#e6e600") +
    labs(title = "Active activity time distribution of user type", x = "", y = ""))


sedentary_percent <- user_type_activity_time %>%
  group_by(user_type) %>%
  summarise(total = active_time+fairly_time+light_time+sedentary_time)%>%
  mutate(sedentary_percent = user_type_activity_time$sedentary_time/total)
  
sedentary_percent$user_type <- factor(sedentary_percent$user_type, levels=c("sedentary","lightly active","fairly active","very active"))
View(sedentary_percent)

ggplot(sedentary_percent)+
  geom_col(aes(user_type, sedentary_percent)) +
  labs(title = "Sedentary time persontage of user type", x = "", y = "")

ggplot(activity_sleep)+
  geom_point(aes(totalsteps, totalminutesasleep))+
  labs(title = "Corelation of daily steps and sleep time", x = "Daily steps", y = "Daily tota lminutes asleep")

ggplot(activity_sleep)+
  geom_point(aes(sedentaryminutes, totalminutesasleep))+ geom_smooth(aes(sedentaryminutes, totalminutesasleep))+
  labs(title = "Corelation of sedentary time and sleep time", x = "Daily sedentary minutes", y = "Daily tota lminutes asleep")




```

## Business advice

Our products should target on full-time employees who spend long hours sitting and seek to improve their health. We can monitor sedentary time and send notifications to users when sedentary hour exceed 8h. At the same time, as sleep quality is also impacted by long sedentary hours, we can give exercise advice to users to reduce sedentary time.

As for users' activity preference, we can further design products and features that help to facilitate lightly active activities.
